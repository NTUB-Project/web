<div class="content">

  <p id="notice"><%= notice %></p>
  <h1>尋找附近</h1>
  <div class="container">
  <div class="row">
    <div class="col-sm-12 col-lg-6">
      <div id="map" style="width:100%;height:600px">地圖預留</div>
    </div>

    <div class="col-sm-12 col-lg-6">
      <div class="row">
        <% @products.each do |product| %>
        <div class="col-6" style="margin-bottom: 20px">
          <div class="nearly">
          <%= link_to image_tag(product.images_urls[0], width: '200px',height: '150px'), product if product.images.present?%>
          <h5><%= product.name %></h5>
          <p><%= product.item %></p>
          <p><%= product.location %></p>
          <p><%= product.tel %></p>
          </div>
        </div>
        <% end %>
      </div>


    </div>
  </div>
  </div>


</div>



<script type="text/javascript">
  handler = Gmaps.build('Google');
  handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
    if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
            var pos = [{
              lat: position.coords.latitude,
              lng: position.coords.longitude,
              picture: {
                url: "https://png.icons8.com/ios/36/0F8A71/marker-filled.png",
                width:  36,
                height: 36
              },
              infowindow: "目前位置"
            }];
            var gmap = <%=raw @hash.to_json %>
            var mark = pos.concat(gmap);
            markers = handler.addMarkers(mark);
            handler.bounds.extendWith(markers);
            _.each(markers, function(markers){
            google.maps.event.trigger(markers.getServiceObject(), 'click');
            });
            handler.fitMapToBounds();
          });
    } else {
      alert("未允許或遭遇錯誤！");
    }
  });

</script>
